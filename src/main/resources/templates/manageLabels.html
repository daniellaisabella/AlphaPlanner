<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Labels</title>
    <link th:href="@{/base.css}" rel="stylesheet">
    <link th:href="@{/button.css}" rel="stylesheet">
    <link th:href="@{/modal.css}" rel="stylesheet">
</head>
<body>
<div class="topbar">
    <div class="logo">
        <img src="/images/alpha-planner-logo.png" alt="Alpha Planner Logo">
    </div>
    <div class="space">
        <a th:href="@{/profil}">Min Profil</a>
        <a th:href="@{/login}" class="logout-button">Log ud</a>
    </div>
</div >

<h1>Labels: </h1>

<table>
    <thead>
    <tr>
        <th>Name</th>

    </tr>
    </thead>
    <tbody>
    <!-- Loop through the labels and display them in rows -->
    <tr th:each="label : ${labels}">
        <td th:text="${label.labelName}">Label Name</td>
        <td>
            <!-- Delete Button -->
            <form action="/tasks/deleteLabel" method="post">
                <input type="hidden" name="label_id" th:value="${label.labelId}">
                <button type="submit" class="btn-link">Slet</button>
            </form>
        </td>
    </tr>
    <tr th:if="${NameExists}">
        <td colspan="2" style="color: red;">Label with that name already exists.</td>
    </tr>
    <tr>
        <td>
        <button class="btn-link" id="createLabelBtn"
                onclick="createNewLabel()">new Label
        </button>
        </td>
    </tr>

    </tbody>
</table>
<br>
<script>

    function createNewLabel(){

        const button = document.getElementById("createLabelBtn");
        button.style.display = "none";

        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Enter label name";
        input.id = "newLabelInput";
        input.required = true;

        const saveButton = document.createElement("button");
        saveButton.innerText = "Save";
        saveButton.onclick = function () {
            const labelName = input.value.trim();
            if (labelName) {
               const formData = new FormData();
               formData.append("labelName", labelName);

               console.log("lable name: ", labelName);

               fetch("/tasks/createLabel", {
                   method: 'POST',
                   body: formData
               })
                   .then(response => {
                       if (response.redirected) {
                           window.location.href = response.url;  // Follow Spring's redirect
                       } else if (response.ok) {
                           window.location.reload();
                       } else {
                           alert("Failed to update task.");
                       }
                   })
                   .catch(error => {
                       console.error("Error:", error);
                   });

            } else {
                alert("Label name cannot be empty.");
            }
        };


        button.parentNode.insertBefore(input, button.nextSibling);
        button.parentNode.insertBefore(saveButton, input.nextSibling);
    }
</script>
</body>
</html>